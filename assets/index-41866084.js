import{S as B}from"./index-fdcfd674.js";import{k as T,_ as A}from"./index-b5fe9ad4.js";import{cJ as oe,f as ne,bo as se,r as d,D as re,aX as m,aY as _,b5 as r,b0 as a,b4 as g,b2 as v,b3 as n,ac as $,b1 as b,b6 as C,ao as ae,br as le,a$ as V,bp as p}from"./index-3f4e5f1d.js";import{g as ie}from"./about-936be77f.js";import{N as ue,a as L,b as G,c as O,e as pe,d as ce,g as de,f as fe}from"./index-9c0fc859.js";import{N as H}from"./Alert-487cf1ec.js";import{N as me}from"./index-6cc41aae.js";import{N as z}from"./Divider-a73b4a7f.js";import"./_plugin-vue_export-helper-c27b6911.js";const F=1,ve=1,ge="Sun-Panel-Config";class j extends Error{constructor(t){super(t),this.name="FormatError"}}class W extends Error{constructor(t){super(t),this.name="ConfigVersionLowError"}}function he(u){const t={version:F,appName:ge,exportTime:T().format("YYYY-MM-DD HH:mm:ss"),appVersion:u||"",md5:""};function s(){t.md5=q(JSON.stringify(t))}return{addIconsData(i){return t.icons=i,this},exportFile(){s();const i=JSON.stringify(t);if(i){const f=new Blob([i],{type:"application/json"}),h=document.createElement("a");h.href=URL.createObjectURL(f),h.download=`SunPanel-Data${T().format("YYYYMMDDHHmm")}.sun-panel.json`,h.click()}},string(){return s(),JSON.stringify(t)}}}function ye(u){let t;try{t=JSON.parse(u)}catch{throw new j("file format error")}const s=xe(t),i=q(u);if(!s)throw new j("file format error");if(t.version<ve)throw new W("");return{isPassCheckMd5:()=>i===s.md5,isPassCheckConfigVersionOld:()=>!(s.version<F),isPassCheckConfigVersionNew:()=>!(s.version>F),isPassCheckConfigVersionBest:()=>s.version===F,jsonStruct:s,hasProperty:f=>f in s,geticons:()=>s.icons||[]}}function xe(u){const t=["version","appName","exportTime","appVersion","md5"];for(const i of t)if(!(i in u))return null;return u}function q(u){try{const t=JSON.parse(u);we(t);const s=JSON.stringify(t);return oe.MD5(s).toString()}catch{return""}}function we(u){for(const t in u)if(t==="md5"){delete u[t];return}}const Ie={class:"pt-2"},be={class:"flex justify-center m-[50px]"},ke={class:"m-[10px]"},Ce={class:"m-[10px]"},Ne={class:"flex justify-center"},Se={href:"https://hslr-s.github.io/sun-panel-tool-page/#/",target:"_blank"},_e={key:0},$e={key:0},Me=g("h2",null,"JSON 数据",-1),De={key:0},Ee={class:"mt-[50px]"},Ve={class:"mt-[50px]"},Be=ne({__name:"index",setup(u){const t=se(),s=d(null),i=d([]),f=d(!1),h=d(!1),N=d(!1),P=d(!1),J=d(""),K=d(!1),S=d(null),M=d(["icons"]),x=d(["icons"]);async function X(){var l,w;const e=(l=S.value)==null?void 0:l.geticons(),o=50;if(!e)return null;try{for(let y=0;y<e.length;y++){const I=e[y],c=await pe({title:I.title,sort:I.sort});if(c.code===0){const R=(w=c.data)==null?void 0:w.id;if(R){let D=[];for(let E=0;E<I.children.length;E++){const k=I.children[E];if(D.push({title:k.title,sort:k.sort,icon:k.icon,url:k.url,lanUrl:k.lanUrl,description:k.description,openMethod:k.openMethod,itemIconGroupId:R}),D.length===o||E===I.children.length-1){const Y=await ce(D);if(Y.code!==0)return Y.msg;D=[]}}}}else return c.msg}return null}catch(y){return y instanceof Error?`${p("common.failed")}: ${y.message}`:p("common.unknownError")}}async function Q(){const e=[],{code:o,data:l}=await de();return o===0?(await Promise.all(l.list.map(async w=>{const y={title:w.title,sort:w.sort,children:[]},I=await fe(w.id);if(I.code===0)for(const c of I.data.list)y.children.push({icon:c.icon,sort:c.sort||99999,title:c.title,url:c.url,lanUrl:c.lanUrl||"",description:c.description||"",openMethod:c.openMethod||1});e.push(y)})),e):[]}re(()=>{ie().then(e=>{e.code===0&&(J.value=e.data.versionName)})});function Z(e){if(P.value=!0,console.log(e.file.file),e.file.file){const o=new FileReader;o.onload=()=>{o.result?(s.value=o.result,U()):t.error(`${p("common.failed")}: ${p("common.repeatLater")}`),P.value=!1},o.readAsText(e.file.file)}}function U(){if(i.value=[],s.value)try{S.value=ye(s.value),S.value&&(S.value.isPassCheckMd5()||i.value.push(p("apps.exportImport.fileModified")),S.value.isPassCheckConfigVersionOld()||i.value.push(p("apps.exportImport.warnConfigFileLow")),S.value.isPassCheckConfigVersionNew()||i.value.push(p("apps.exportImport.softwareVersionLow")),f.value=!f.value)}catch(e){e instanceof W?(t.error(p("apps.exportImport.errorConfigFileLow")),console.error("The configuration file version is too low to be compatible")):e instanceof j&&(t.error(p("apps.exportImport.errorConfigFileFormat")),console.error("The format is incorrect and cannot be imported"))}else t.error(p("apps.exportImport.errorConfigFileFormat"))}async function ee(){N.value=!0;const e=he(J.value);if(x.value.includes("icons")){console.log("export icons ...");const o=await Q();e.addIconsData(o),console.log("export icons finish",o)}s.value=e.string(),e.exportFile(),N.value=!1,h.value=!1}async function te(){if(N.value=!0,x.value.includes("icons")){console.log("export icons ...");const e=await X();e!==null&&t.success(`${p("common.failed")}:${e}`)}N.value=!1,f.value=!1,t.success(`${p("common.success")}, ${p("common.refreshPage")}`)}return(e,o)=>(m(),_("div",Ie,[r(n(H),{type:"info",bordered:!1},{default:a(()=>[g("p",null,v(e.$t("apps.exportImport.tip")),1)]),_:1}),g("div",be,[g("div",ke,[r(n(ue),{accept:".sun-panel.json,.sunpanel.json","directory-dnd":"","default-upload":!1,"show-file-list":!1,onChange:Z},{default:a(()=>[r(n($),{type:"info",size:"large",loading:P.value},{icon:a(()=>[r(n(B),{icon:"fa6:solid-file-import"})]),default:a(()=>[b(" "+v(e.$t("apps.exportImport.import")),1)]),_:1},8,["loading"])]),_:1})]),g("div",Ce,[r(n($),{type:"info",size:"large",onClick:o[0]||(o[0]=l=>h.value=!h.value)},{icon:a(()=>[r(n(B),{icon:"fa6:solid-file-export"})]),default:a(()=>[b(" "+v(e.$t("apps.exportImport.export")),1)]),_:1})])]),g("div",Ne,[g("a",Se,v(e.$t("apps.exportImport.transmuteStandard")),1)]),K.value?(m(),_("div",_e,[r(n($),{onClick:U},{default:a(()=>[b(" 检查导入 ")]),_:1}),r(n($),{onClick:o[1]||(o[1]=l=>s.value="")},{default:a(()=>[b(" 清空导入数据 ")]),_:1}),r(n(me),{value:s.value,"onUpdate:value":o[2]||(o[2]=l=>s.value=l),type:"textarea",placeholder:"基本的 Textarea"},null,8,["value"]),s.value?(m(),_("div",$e,[Me,g("pre",null,v(s.value),1)])):C("",!0)])):C("",!0),r(n(A),{show:f.value,"onUpdate:show":o[4]||(o[4]=l=>f.value=l),style:{"max-width":"400px"},title:e.$t("apps.exportImport.import")},{default:a(()=>[i.value.length>0?(m(),_("div",De,[r(n(H),{title:e.$t("common.warning"),type:"warning"},{default:a(()=>[(m(!0),_(ae,null,le(i.value,(l,w)=>(m(),_("div",{key:w},v(l),1))),128))]),_:1},8,["title"])])):C("",!0),r(n(z),{"title-placement":"left"},{default:a(()=>[b(v(e.$t("apps.exportImport.selectImportData")),1)]),_:1}),r(n(L),{justify:"center",style:{"margin-top":"20px"}},{default:a(()=>[r(n(G),{value:x.value,"onUpdate:value":o[3]||(o[3]=l=>x.value=l)},{default:a(()=>[M.value.includes("icons")?(m(),V(n(O),{key:0,value:"icons",label:e.$t("apps.exportImport.moduleIcon")},null,8,["label"])):C("",!0),M.value.includes("style")?(m(),V(n(O),{key:1,value:"style",label:e.$t("apps.exportImport.moduleStyle")},null,8,["label"])):C("",!0)]),_:1},8,["value"])]),_:1}),r(n(L),{justify:"center"},{default:a(()=>[g("div",Ee,[r(n($),{type:"success",disabled:x.value.length===0,loading:N.value,onClick:te},{default:a(()=>[b(v(e.$t("common.continue")),1)]),_:1},8,["disabled","loading"])])]),_:1})]),_:1},8,["show","title"]),r(n(A),{show:h.value,"onUpdate:show":o[6]||(o[6]=l=>h.value=l),style:{"max-width":"400px"},title:e.$t("apps.exportImport.export")},{default:a(()=>[r(n(z),{"title-placement":"left"},{default:a(()=>[b(v(e.$t("apps.exportImport.selectExportData")),1)]),_:1}),r(n(L),{justify:"center",style:{"margin-top":"20px"}},{default:a(()=>[r(n(G),{value:x.value,"onUpdate:value":o[5]||(o[5]=l=>x.value=l)},{default:a(()=>[M.value.includes("icons")?(m(),V(n(O),{key:0,value:"icons",label:e.$t("apps.exportImport.moduleIcon")},null,8,["label"])):C("",!0),M.value.includes("style")?(m(),V(n(O),{key:1,value:"style",label:e.$t("apps.exportImport.moduleStyle")},null,8,["label"])):C("",!0)]),_:1},8,["value"])]),_:1}),r(n(L),{justify:"center"},{default:a(()=>[g("div",Ve,[r(n($),{type:"success",disabled:x.value.length===0,loading:N.value,onClick:ee},{default:a(()=>[b(v(e.$t("common.continue")),1)]),_:1},8,["disabled","loading"])])]),_:1})]),_:1},8,["show","title"])]))}});export{Be as default};
